# Kittygram

[![CI/CD Workflow](https://github.com/maxim-petrov/kittygram_final/actions/workflows/main.yml/badge.svg
)](https://github.com/maxim-petrov/kittygram_final/actions)

Kittygram — финальный проект по контейнеризации и CI/CD, демонстрирующий работу микросервисной архитектуры с использованием Docker, Docker Compose, Nginx и GitHub Actions.

---

## Содержание

- [Описание проекта](#описание-проекта)
- [Ссылка на развернутый проект](#ссылка-на-развернутый-проект)
- [Продакшн и разработка](#продакшн-и-разработка)
- [Инструкция по развёртыванию](#инструкция-по-развёртыванию)
  - [Локальный запуск](#локальный-запуск)
  - [Развёртывание на удалённом сервере](#развёртывание-на-удалённом-сервере)
- [Технологии](#технологии)
- [Автор проекта](#автор-проекта)

---

## Описание проекта

**Kittygram** — это комплексное веб-приложение, состоящее из трех основных компонентов:
- **Бэкенд** на Django для обработки бизнес-логики и работы с базой данных PostgreSQL.
- **Фронтенд** для взаимодействия с пользователями.
- **Gateway** (на базе Nginx) для проксирования запросов и раздачи статических файлов.

Проект демонстрирует контейнеризацию с помощью Docker, автоматизацию сборки, тестирования и деплоя посредством GitHub Actions, а также разделение конфигураций для разработки и продакшн-окружения.

---

## Ссылка на развернутый проект

Развернутая версия доступна по адресу: https://mptrv.hopto.org

---

## Продакшн и разработка

Проект поставляется в двух вариантах:

- **Обычная (Development)**  
  Используется для локальной разработки и тестирования. Имеет упрощённую конфигурацию, активированный режим отладки и подробное логирование.

- **Продакшн**  
  Предназначена для развёртывания на удалённых серверах. Содержит оптимизированные настройки безопасности и производительности, отключённый режим отладки, а также разделение логов и статики для повышения отказоустойчивости.

**Когда использовать:**
- При активной разработке и локальном тестировании запускайте контейнеры через `docker-compose.yml`.
- Для публичного доступа и работы с реальными пользователями — используйте `docker-compose.production.yml`.

---

## Инструкция по развёртыванию

### Локальный запуск

1. **Клонирование репозитория:**

   ```bash
   git clone git@github.com:maxim-petrov/kittygram_final.git
   cd kittygram_final
   
2. **Настройка окружения:**

   Скопируйте пример файла окружения и настройте переменные:

   ```bash
   cp .env.example .env
   
3. **Запуск контейнеров:**

   Соберите и запустите контейнеры:

   ```bash
   docker-compose up --build

4. **Доступ к сервисам:**

   Фронтенд: http://localhost:3000
   Бэкенд: http://localhost:8000

5. **Дополнительные команды:**

   Для применения миграций и сбора статики (в контейнере бэкенда):

   ```bash
   docker-compose exec backend python manage.py migrate
   docker-compose exec backend python manage.py collectstatic --noinput

### Развёртывание на удалённом сервере

1. **Подготовка сервера:**

   - Очистите кеши и ненужные данные:
       ```bash
       npm cache clean --force
       sudo apt clean
       sudo journalctl --vacuum-time=1d
       sudo docker system prune -af
   - Удалите старые сервисы (например, прежний Gunicorn для Kittygram).
   - Создайте директорию для проекта:
        ```bash
       mkdir ~/kittygram
   
2. **Настройка Nginx:**

   - Измените конфигурацию Nginx так, чтобы все запросы перенаправлялись в Docker контейнер на порт 9000.
   - Перезапустите Nginx:

   ```bash
   sudo systemctl restart nginx
   
3. **Деплой с помощью GitHub Actions:**

    При пуше в ветку main запускается workflow, который:

    - Проверяет код (PEP8, тесты).
    - Собирает образы и отправляет их на Docker Hub.
    - Обновляет контейнеры на сервере.
    - Выполняет миграции и сбор статики.
    - Отправляет уведомление в Telegram об успешном деплое.
   
    Убедитесь, что файл `.github/workflows/main.yml` настроен с вашими данными.

4. **Запуск продакшн-версии:**

   На сервере запустите контейнеры из файла `docker-compose.production.yml`:

   ```bash
   docker-compose -f docker-compose.production.yml up -d --build

## Технологии

- **Контейнеризация и оркестрация:** Docker, Docker Compose
- **CI/CD:** GitHub Actions
- **Бэкенд:** Python, Django
- **Фронтенд:** JavaScript (React или аналогичный фреймворк)
- **Обратный прокси и статика:** Nginx
- **База данных:** PostgreSQL

## Автор проекта

Maxim Petrov
GitHub: maxim-petrov
